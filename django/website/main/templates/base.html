{% load assets %}
{% load settings_value %}
{% load i18n %}
{% load waffle_tags %}

<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% settings_value "SITE_NAME" %} MIS {% block title %}{% endblock %}</title>
    {% block extra_media %}
    {% endblock %}
    {% assets "css_all" %}
    <link rel="stylesheet" href="{{ ASSET_URL }}">
    {% endassets %}
    <script>window.Aptivate = {};</script>
</head>
<body{% block body_attrs %}{% endblock %}>
    <div class="body"> {# Created because ui.jquery really doesn't like sized <body> #}

    <header class="page-header">
       <h1 class="logo"><a href="/"><img src="{% settings_value "SITE_LOGO" %}" /><span class="site-name">{% settings_value "SITE_NAME" %}</span></a></h1>
       <nav class="main-navigation">
        {% block organization_switching_form %}
        {% if request.user and request.user.is_authenticated and request.user.organizations_organization.exists %}
		<form id="organizations-switch" action="{% url "switch-organizations" %}" method="post">{% csrf_token %}
            <select id="organizations-switch-select" name="organization" onchange="this.form.submit();"{% if organization_list|length == 1 and not perms.organizations.add_organization %} disabled="disabled"{% endif %}>
                {% for organization in organization_list %}<option value="{{ organization.id }}"{% if request.user.preferences.last_viewed_organization == organization %} selected="selected"{% endif %}>{{ organization.name }}</option>{% endfor %}
                {% if perms.organizations.add_organization %}
                    <option value="-1">{% trans "Create a new Organization" %}</option>
                {% endif %}
            </select>
        </form>
        {%  endif %}
        {% endblock organization_switching_form %}

        {% block logframe_switching_form %}
        {% if request.user and request.user.is_authenticated and request.user.preferences.last_viewed_organization and logframe_list %}
        <form id="logframes-switch" action="{% url "switch-logframes" request.user.preferences.last_viewed_organization.slug %}" method="post">{% csrf_token %}
            <select id="logframes-switch-select" name="logframe" onchange="this.form.submit();"{% if logframe_list|length == 1 and not perms.logframe.add_logframe %} disabled="disabled"{% endif %}>
            	{% for logframe in logframe_list %}<option value="{{ logframe.id }}"{% if request.user.preferences.last_viewed_logframe == logframe %} selected="selected"{% endif %}>{{ logframe.name }}</option>{% endfor %}
        {% if perms.logframe.add_logframe %}
            	<option value="-1">{% trans "Create a new Logframe" %}</option>
            	{% endif %}
			</select>
		</form>
		{% endif %}
		{% endblock logframe_switching_form %}

        {% if request.user and request.user.is_authenticated %}
         <div class="account-links-auth"><a href="{% url "logout" %}">{% trans "Log out" %}</a></div>
         {% if request.user.preferences.last_viewed_logframe %}
            <div class="navigation-link"><a href="{% url "logframe-dashboard" request.user.preferences.last_viewed_logframe.organization.slug request.user.preferences.last_viewed_logframe.slug %}" id="nav-dashboard">{% blocktrans with request.user.preferences.last_viewed_logframe.name as logframe_name %}{{ logframe_name }} Overview{% endblocktrans %}</a></div>
         {% endif %}
         <div class="account-links-profile"><span>{% trans "Logged in as:" %} </span><a href="{% url "personal_edit" %}">{{ request.user.get_full_name|default:request.user.business_email }}</a></div>
        {% else %}
            <div class="account-links-auth"><a href="{% url "login" %}">{% trans "Log in" %}</a></div>
            <div class="account-links-auth"><a href="{% url "registration_register" %}">{% trans "Register" %}</a></div>
            {% endif %}
            {% if request.user and request.user.is_authenticated %}
                {% if perms.contacts.add_user and request.user.organizations_organization.exists %}
            <div class="navigation-link" id="nav-people"><a href="{% url "contact_list" request.user.preferences.last_viewed_organization.slug %}">{% trans "People" %}</a></div>
                {% endif %}
            {% endif %}
        </nav>
    </header>
    <div class="content-box">
        {% block main_menu %}
        {% endblock main_menu %}

        {% if messages %}
        <div class="messagelist">
            {% for message in messages %}
            <div class="no-select message message-{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="content" id="wrapper">
            {% block content %}{% endblock %}
        </div>
    </div>

    <footer>
        <div class="siteinfo"><p>Built by <a href="http://aptivate.org">Aptivate</a></p></div>
    </footer>
    </div> {# div.body #}
    {% block post_footer %}{% endblock %}
    {% block wafflejs %}
    <script>
    {% wafflejs %}
    </script>
    {% endblock %}
    {% if deploy_env == "staging" or deploy_env == "production" %}
    <script data-main="{{ STATIC_URL }}dist/logframe.min.js" src="{{ STATIC_URL }}js/lib/require.js"></script>
    {% else %}
    <script data-main="{{ STATIC_URL }}js/main.js" src="{{ STATIC_URL }}js/lib/require.js"></script>
    {% endif %}
</body>
</html>
